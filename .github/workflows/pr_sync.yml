name: Remove safe-to-test label when new commits are pushed

on:
  pull_request:
    types: [synchronize]

jobs:
  remove-label:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    env:
      LABEL_NAME: safe-to-test
      REPO: ${{ github.event.pull_request.base.repo.full_name }}
      PR_NUMBER: ${{ github.event.pull_request.number }}

    steps:
      - name: Remove label
        run: |
          echo "Removing label '$LABEL_NAME' from PR #$PR_NUMBER on repo $REPO" 
          gh api repos/$REPO/issues/$PR_NUMBER/labels/$LABEL_NAME -X DELETE || true
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
